<!DOCTYPE html>
<html>
  <head>
    <title>Compile CoffeeScript and LESS</title>
    <style type="text/css">
      body {margin:10px;font-size:1.5em}
      div {background-color:#eee;border-radius:10px;color:#666;padding:10px}
      #holder {border:8px dashed #ccc}
      #result-box {position:absolute;top:75px;bottom:0;right:0;left:0;margin:10px;padding:20}
      pre#result {height:100%;margin:0;overflow:auto}
    </style>
  </head>
  <body>
    <!-- this div will receive dropped files to compile -->
    <div id="holder">Drop a CoffeeScript or LESS file here</div>
    <div id="result-box">
      <pre id="result"></pre>
    </div>
    <script type="text/javascript" src="coffee-script-1.3.3.min.js"></script>
    <script type="text/javascript" src="less-1.3.0.min.js"></script>
    <script type="text/javascript">
    (function() {
      var holder = document.getElementById('holder')
      var result = document.getElementById('result')

      holder.ondrop = function(e) {
        e.preventDefault()
        var file = e.dataTransfer.files[0]
        var reader = new FileReader()
        reader.onload = function(event) {
          var name = file.name
          if (name.lastIndexOf('.coffee') === name.length-7)
            result.textContent = CoffeeScript.compile(event.target.result)
          else if (name.lastIndexOf('.less') === name.length-5) {
            (new(less.Parser)).parse(event.target.result, function(e,r){
              if (e)
                result.textContent = "Error\nLine " + e.line + ", Column " + e.column + "\n" + e.message
              else
                result.textContent = r.toCSS()
            })
          } else
            result.innerHTML = 'Please insert a Coffeescript (.coffee) or LESS (.less) file'
        }
        reader.onerror = function() {
          result.innerHTML = 'Unable to read ' + file.name
        }
        reader.readAsText(file)
        return false
      }
    })()
    </script>
  </body>
</html>
